import dayjs from "dayjs";
import customParseFormat from "dayjs/plugin/customParseFormat";
dayjs.extend(customParseFormat);
import { SlashCommandBuilder, PermissionsBitField } from "discord.js";
import { SlashCommand } from "../types";
import { birthdayAdd } from "../utils/mongo";

const command: SlashCommand = {
    data: new SlashCommandBuilder()
        .setName("channel")
        .setDescription("Set birthday channel")
        .addChannelOption((option) => option.setName("channel").setDescription("Birthday channel").setRequired(true)),
    execute: async (interaction) => {
        const channel = interaction.options.getChannel("channel", true);

        const hasPermission = interaction.memberPermissions?.has(PermissionsBitField.Flags.ModerateMembers);

        if (hasPermission) {
            // const res = await mongoChannel();
            const res = { ver: 1 };
            await interaction.reply({
                content: `Birthday channel is ${res.ver === 1 ? "added" : "updated"}! | Channel: <#${channel.id}>`,
                ephemeral: true,
            });
        } else {
            await interaction.reply({
                content: `You do not have permission to do that!`,
                ephemeral: true,
            });
        }
    },
};

export default command;
